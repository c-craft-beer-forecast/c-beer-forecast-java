<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H&C inc. ç®¡ç†è€…ãƒšãƒ¼ã‚¸</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
</head>

<body>
    <header class="admin-header">
        <div class="header-left">
            <span class="company-name">H&C inc</span>
        </div>
        <div class="header-right">
            <span class="employee-id">ç¤¾å“¡ç•ªå· : <span th:text="${session.loginUser.id}">1234</span></span>
            <a th:href="@{/admin-login}" class="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>

        </div>
    </header>

    <div class="admin-container">
        <aside class="sidebar">
            <nav>
                <ul>
                    <li><a href="#" class="sidebar-item active" data-content="demand-prediction">éœ€è¦äºˆæ¸¬</a></li>
                    <li><a href="#" class="sidebar-item" data-content="sales-performance">è²©å£²å®Ÿç¸¾</a></li>
                    <li><a href="#" class="sidebar-item" data-content="employee-management">å¾“æ¥­å“¡ç®¡ç†</a></li>
                    <!-- <li><a th:href="@{/changepassword}" class="switch-button">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</a></li> -->
                </ul>
            </nav>
        </aside>

        <main class="content-area">
            <div id="demand-prediction" class="content-section active">
                <h2>éœ€è¦äºˆæ¸¬</h2>
                <p>
                <div class="container">
                    <h1>ğŸº ãƒ“ãƒ¼ãƒ«ç™ºæ³¨æ¨å¥¨é‡å–å¾—ã‚·ã‚¹ãƒ†ãƒ </h1>
                    <button id="getOrderBtn">ç™ºæ³¨æ¨å¥¨é‡ã‚’å–å¾—</button>
                    <div id="loading">ãƒ­ãƒ¼ãƒ‰ä¸­...</div>
                    <div id="result">
                        <h2>ç™ºæ³¨æ¨å¥¨é‡</h2>
                        <div id="orderRecommendationsContainer"></div>
                    </div>
                    <div id="errorMessages" class="error"></div>
                </div>

                <script>
                    document.getElementById('getOrderBtn').addEventListener('click', fetchOrderRecommendations);

                    async function fetchOrderRecommendations() {

                        const loadingDiv = document.getElementById('loading');
                        const resultDiv = document.getElementById('orderRecommendationsContainer');
                        const errorDiv = document.getElementById('errorMessages');

                        loadingDiv.style.display = 'block';
                        resultDiv.innerHTML = '';
                        errorDiv.innerHTML = '';

                        const endpoint = 'https://beer-forecast-model-function.azurewebsites.net/api/get_order_recommendations';

                        try {
                            const response = await fetch(endpoint, {
                                method: 'GET',
                                headers: {

                                }
                            });

                            if (!response.ok) {
                                const errorText = await response.text();
                                throw new Error(`HTTP error! Status: ${response.status}, Message: ${errorText}`);
                            }

                            const data = await response.json();
                            console.log('å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:', data);

                            if (data.order_recommendations && data.order_recommendations.length > 0) {
                                data.order_recommendations.forEach(rec => {
                                    const card = document.createElement('div');
                                    card.className = 'order-card';
                                    card.innerHTML = `
                            <p><strong>ç™ºæ³¨æ—¥:</strong> ${rec.order_date} (${rec.order_day_label})</p>
                            <p><strong>ã‚«ãƒãƒ¼æœŸé–“:</strong> ${rec.coverage_period_start} ã‹ã‚‰ ${rec.coverage_period_end}</p>
                            <table>
                                <thead>
                                    <tr>
                                        <th>ãƒ“ãƒ¼ãƒ«ç¨®é¡</th>
                                        <th>æ¨å¥¨é‡ (${data.unit})</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(rec.ordered_beers).map(([beerType, quantity]) => `
                                        <tr>
                                            <td>${beerType.replace('(æœ¬)', '')}</td>
                                            <td>${quantity}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                                    resultDiv.appendChild(card);
                                });
                            } else {
                                resultDiv.innerHTML = '<p>ç™ºæ³¨æ¨å¥¨é‡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                            }

                        } catch (error) {
                            console.error('ç™ºæ³¨æ¨å¥¨é‡ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                            errorDiv.innerHTML = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                        } finally {
                            loadingDiv.style.display = 'none';
                        }
                    }
                </script>
                </p>
            </div>

            <div id="sales-performance" class="content-section">
                <h2>è²©å£²å®Ÿç¸¾</h2>
                <p>
                <h1>å¤©æ°—</h1>
                <table border="1">
                    <tr>
                        <th>è¨˜éŒ²æ—¥</th>
                        <th>å¹³å‡æ°—æ¸© (â„ƒ)</th>
                        <th>å¤©æ°—</th>

                    </tr>
                    <tr th:each="weather : ${weatherList}">
                        <td th:text="${weather.recordDate}">2025-06-23</td>
                        <td th:text="${weather.avgTempC}">25.5</td>
                        <td th:text="${weather.weatherName}">æ™´ã‚Œ</td>
                    </tr>
                </table>
                <h2>è²©å£²å®Ÿç¸¾ç™»éŒ²</h2>
                <form th:action="@{/admin/sales/submitAll}" method="post">
                    <input type="hidden" name="salesNumber" th:value="${salesResult.salesNumber}" />
                    <label for="date">æ—¥ä»˜:</label>
                    <input type="date" id="date" name="date" th:value="${salesResult.date}" required />
                    <label for="numOfCustomers">æ¥å®¢äººæ•°ï¼š</label>
                    <input type="number" id="numOfCustomers" name="numOfCustomers"
                        th:value="${salesResult.numOfCustomers}" required />
                    <table>
                        <thead>
                            <tr>
                                <th>å•†å“å</th>
                                <th>å£²ä¸Šæœ¬æ•°</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="product : ${productList}">
                                <td th:text="${product.name}"></td>
                                <td>
                                    <input type="number" name="numOfSalesList" min="0" required />
                                    <input type="hidden" name="productIdList" th:value="${product.id}" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="submit" class="submit-btn">ç™»éŒ²</button>
                </form>

                <!-- ç·¨é›†æ™‚å‰Šé™¤ -->
                <div th:if="${salesResult.salesNumber != null}">
                    <form th:action="@{/admin/sales/delete}" method="post">
                        <input type="hidden" name="id" th:value="${salesResult.salesNumber}" />
                        <button type="submit" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">å‰Šé™¤</button>
                    </form>
                </div>

                <!-- å®Ÿç¸¾è¡¨ç¤º -->
                <h2>è²©å£²å®Ÿç¸¾</h2>
                <form th:action="@{/admin}" method="get">
                    <label for="date">æ—¥ä»˜é¸æŠ:</label>
                    <input type="date" id="date" name="date" th:value="${selectedDate}" required />
                    <button type="submit">è¡¨ç¤º</button>
                </form>
                <table border="1">
                    <thead>
                        <tr>
                            <th>å•†å“</th>
                            <th>å£²ä¸Šæœ¬æ•°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="item : ${summaryList}">
                            <td th:text="${item[3]}"></td>
                            <td th:text="${item[4]}"></td>
                            <td>
                                <a th:href="@{'/admin/edit/sales?id=' + ${item[0]} }">ç·¨é›†</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </p>
            <div id="employee-management" class="content-section">
                <h2>å¾“æ¥­å“¡ç®¡ç†</h2>
                <p>
                <h2>å¾“æ¥­å“¡ä¸€è¦§</h2>
                <table border="1">
                    <tr>
                        <th>ç¤¾å“¡ç•ªå·</th>
                        <th>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</th>
                        <th>åå‰</th>
                        <th>ç®¡ç†è€…</th>
                    </tr>
                    <tr th:each="emp : ${employeeList}">
                        <td th:text="${emp.id}">1</td>
                        <td th:text="${emp.email}">email@example.com</td>
                        <td th:text="${emp.name}">åå‰</td>
                        <td th:text="${emp.Admin} ? 'âœ”' : ''"></td>
                        <td>
                            <a th:href="@{'/edit/' + ${emp.id}}" class="logout-btn">ç·¨é›†</a>

                            <form th:action="@{'/delete/' + ${emp.id}}" method="post">
                                <button type="submit">å‰Šé™¤</button>
                            </form>
                        </td>
                    </tr>
                </table>

                <!-- å¾“æ¥­å“¡è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
                <h2>å¾“æ¥­å“¡è¿½åŠ </h2>
                <form th:action="@{/add}" th:object="${employee}" method="post">
                    <p>åå‰ï¼š<input type="text" th:field="*{name}" /></p>
                    <p>ãƒ¡ãƒ¼ãƒ«ï¼š<input type="email" th:field="*{email}" /></p>
                    <p>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š<input type="password" th:field="*{password}" /></p>
                    <p> <label class="inline-checkbox-label">
                            <input type="checkbox" th:field="*{admin}" />
                            ç®¡ç†è€…æ¨©é™
                        </label></p>
                    <button type="submit">å®Œäº†</button>
                </form>
                </p>
        </main>
    </div>

    <script src="script.js"></script>
</body>

</html>